<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="Access-Control-Allow-Origin" content="*">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
  <script src="./echarts.js"></script>
  <script src="./macarons.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.js" type="text/javascript"></script>
    <script src="./drawingboard.js/dist/drawingboard.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
  <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>
  <link rel="stylesheet" href="https://pingendo.com/assets/bootstrap/bootstrap-4.0.0-beta.1.css" type="text/css">
  <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style type="text/css">
    #compass,
    #gradienter {
      width: 320px;
      height: 568px;
      position: absolute;
      top: 0;
      left: 0;
      transition: left 218ms;
    }

    #gradienter {
      left: 320px;
    }

    .nav {
      list-style: none;
      padding-left: 0;
      position: absolute;
      top: 500px;
      left: 160px;
      margin-left: -15px;
    }

    .nav li {
      height: 8px;
      width: 8px;
      border-radius: 4px;
      background-color: rgba(255, 255, 255, .4);
      display: inline-block;
    }

    .nav li+li {
      margin-left: 10px;
    }

    .nav li.active {
      background-color: rgba(255, 255, 255, 1);
    }
  </style>
</head>

<body>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center"> <svg id="face" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve" onclick="changeFace()"
            class="face">
				<g>
					<path class="st0" d="M27,2.5c1.4,0,2.5,1.1,2.5,2.5v22.2c0,1.4-1.1,2.5-2.5,2.5H4.8c-1.4,0-2.5-1.1-2.5-2.5V4.9
						c0-1.4,1.1-2.5,2.5-2.5H27 M27,0H4.8C2.1,0-0.1,2.2-0.1,4.9v22.2c0,2.7,2.2,4.9,4.9,4.9H27c2.7,0,4.9-2.2,4.9-4.9V4.9
						C31.9,2.2,29.7,0,27,0L27,0z" contenteditable="true"></path>

            <path id="active-mouse" class="st1" d="M23.1,20.8c0,3.5-3.2,6.3-7.1,6.3c-3.9,0-7.1-2.8-7.1-6.3s3.2,0,7.1,0C19.9,20.8,23.1,17.3,23.1,20.8z"></path>



        <path style="display:none" id="negative-mouse" class="st1" d="M8.2,22.4c-0.4-0.6-0.1-1.4,0.7-1.8c4.3-2.1,9.3-2.1,13.5,0c0.8,0.4,1.1,1.2,0.7,1.8l0,0
      c-0.4,0.6-1.1,0.7-1.8,0.4c-3.6-1.8-7.8-1.8-11.4,0C9.3,23.1,8.5,23,8.2,22.4L8.2,22.4z"></path>


					<path id="neutral-mouse" class="st1" d="M17.6,23.2c0,0.5-0.4,0.9-0.9,0.9h-1.4c-0.5,0-0.9-0.4-0.9-0.9l0,0c0-0.5,0.4-0.9,0.9-0.9h1.4
						C17.2,22.3,17.6,22.7,17.6,23.2L17.6,23.2z" style="display:none">
						</path>
					<g>
						<g>
							<circle id="left-eye-open" class="st2" cx="10.8" cy="13.4" r="1.1"></circle>
              <path style="display:none" stroke="null" id="left-eye-close" d="m12.982887,13.459018c0,0.281031 -0.540766,0.505856 -1.216723,0.505856l-1.89268,0c-0.675957,0 -1.216723,-0.224825 -1.216723,-0.505856l0,0c0,-0.281031 0.540766,-0.505856 1.216723,-0.505856l1.89268,0c0.675957,0 1.216723,0.224825 1.216723,0.505856l0,0z" class="st2"></path>
						</g>
						<g>
							<circle id="right-eye-open" class="st2" cx="21.2" cy="13.4" r="1.1"></circle><path stroke="null" id="right-eye-close" style="display:none" d="m23.568462,13.571631c0,0.281031 -0.540765,0.505856 -1.216722,0.505856l-1.89268,0c-0.675957,0 -1.216722,-0.224825 -1.216722,-0.505856l0,0c0,-0.281031 0.540765,-0.505856 1.216722,-0.505856l1.89268,0c0.675957,0 1.216722,0.224825 1.216722,0.505856l0,0z" class="st2"></path>
            </g>
						<path class="st3" d="M21.2,8.8c-2.3,0-4.3,1.8-4.6,4h-1.1c-0.1,0-0.1,0-0.1,0c-0.3-2.3-2.2-4-4.6-4c-2.5,0-4.6,2.1-4.6,4.6
							c0,2.5,2.1,4.6,4.6,4.6c2.3,0,4.3-1.8,4.6-4c0,0,0.1,0,0.1,0h1.1c0.3,2.3,2.2,4,4.6,4c2.5,0,4.6-2.1,4.6-4.6
							C25.8,10.9,23.7,8.8,21.2,8.8z M10.9,16.8c-1.9,0-3.4-1.5-3.4-3.4S9,10,10.9,10c1.9,0,3.4,1.5,3.4,3.4S12.7,16.8,10.9,16.8z
							 M21.2,16.8c-1.9,0-3.4-1.5-3.4-3.4s1.5-3.4,3.4-3.4c1.9,0,3.4,1.5,3.4,3.4S23.1,16.8,21.2,16.8z"></path>
					</g>
				</g>
				</svg> </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h1>Acceleration Change</h1>
          <canvas width=400% height=500% id="chart"></canvas>
        </div>
        <div class="col-md-4 text-center">
          <h1>Compass</h1><br><br><br><br>
          <iframe name="content_iframe" marginwidth=0 marginheight=0 width=130 height=40 src="H5Compass.html" style="zoom:1000%" frameborder=0></iframe> 
        </div>
        <div class="col-md-4 text-center">
          <h1>Draw Board</h1>
          <div id="drawBoard" style="width:350px;height:500px;">

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center" id="weather">
          <h1>Weather Info</h1>
        </div>
        <div class="col-md-4 text-center" id="geoimg">
          <h1>Location Info</h1>
          <iframe id="map" frameborder="0" style="border:0" allowfullscreen=""> </iframe>
        </div>
        <div class="col-md-4" id="news">
          <h1 class="text-center">News</h1>
          <ul id="newsList"> </ul>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 text-center">
          <a href="#" class="btn btn-outline-success" onclick="getWeather()">Get Weather Info</a>
        </div>
        <div class="col-md-4 text-center">
          <a href="#" class="btn btn-outline-danger" onclick="getLocation()">Get Location Info</a>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center">
            <div class="btn-group">
              <button class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown" id="category">Category</button>
              <div class="dropdown-menu">
                <h6 class="dropdown-item" id="1">business</h6>
                <div class="dropdown-divider" id="2"></div>
                <h6 class="dropdown-item" id="3">entertainment</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="4">gaming</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="5">general</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="6">music</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="7">politics</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="8">science-and-nature</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="9">sport</h6>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-item" id="0">technology</h6>
              </div>
              <div class="btn-group">
                <button class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown" id="language">Language</button>
                <div class="dropdown-menu">
                  <h6 class="dropdown-item" id="11">English</h6>
                  <div class="dropdown-divider"></div>
                  <h6 class="dropdown-item" id="12">French</h6>
                  <div class="dropdown-divider"></div>
                  <h6 class="dropdown-item" id="13">German</h6>
                </div>
              </div>
              <a href="#" class="btn btn-outline-warning" onclick="getNews()">Get News Info</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyD4N3FLCuMwmzdvQxCpeo0VI40wEEMF0Z4",
      authDomain: "jsonvisualize.firebaseapp.com",
      databaseURL: "https://jsonvisualize.firebaseio.com",
      projectId: "jsonvisualize",
      storageBucket: "jsonvisualize.appspot.com",
      messagingSenderId: "690434506338"
    };
    var app = firebase.initializeApp(config);
    var db = firebase.database(app)
    function visualizeJson(data){
      var ref = db.ref()
      ref.set(data)
    }

    //set up weather
    var weatherAppid = 'b1b15e88fa797225412429c1c50c122a1'
    var googleMapKey = 'AIzaSyD3N7NC_ztTEmHt8BugovKtg1sHCOyfs6Y'
    //set up news
    newsDescriptions= []

    function getWeather(){
      navigator.geolocation.getCurrentPosition(function(position){
        lat = position.coords.latitude
        lng = position.coords.longitude
        lat = lat.toString()
        lng = lng.toString()
        url = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+lat+','+lng+'&key=AIzaSyD3N7NC_ztTEmHt8BugovKtg1sHCOyfs6Y'

        $.getJSON(url,function(res){
          results = res['results']
          city = results[0]['address_components'][3]['long_name']
          url = "'http://openweathermap.org/data/2.5/weather?q="+city+"&appid=b1b15e88fa797225412429c1c50c122a1'"
          $.getJSON('https://query.yahooapis.com/v1/public/yql',{q:"select * from json where url="+url,format: 'json'},function(data){
            data = data.query.results.json
            city = data['name']
            //description = data['weather'][0]['description']
            humidity = data['main']['humidity']
            pressure = data['main']['pressure']
            temp_avg = data['main']['temp']
            temp_max = data['main']['temp_max']
            temp_min = data['main']['temp_min']
            wind_direction = data['wind']['degree']
            wind_speed = data['wind']['speed']
            time = new Date(data['dt']*1000)
            year = time.getFullYear()
            months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
            month = months[time.getMonth()]
            date = time.getDate()
            weatherText = 'city: '+city+'<br>Date: '+year+' '+month+' '+date+'<br>humidity: '+humidity+'<br>pressure: '+pressure+'<br>averate temperature: '+temp_avg+'<br>max temperature: '+temp_max+'<br>min temperature: '+temp_min
            $('#weather').html(' <h1>Weather Info</h1>'+weatherText)
          })
        })
      })
    }

    function getLocation(weather,geoimg){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(position){
          lat = position.coords.latitude
          lng = position.coords.longitude
          lat = lat.toString()
          lng = lng.toString()

          key='AIzaSyBodP6oeVHbnemHJ-vE4e3v6KJbWNBy8Y s'
          url = 'https://www.google.com/maps/embed/v1/streetview?key='+key+'&location='+lat+','+lng+'&heading=210&pitch=10&fov=35'
          $('#map').attr({src:url,height:256,width:260})
          
        });
      }
      
    } 

    function getNews(){
      var text = $('#category').text()
      if(text==='Category'||text==='Language'){
        alert('Please select news category and language')
        return
      }
      newsKey = '4e9089688f0a454c95b59f97f4b994d0'
      navigator.geolocation.getCurrentPosition(function(position){
        lat = position.coords.latitude
        lng = position.coords.longitude
        lat = lat.toString()
        lng = lng.toString()
        url = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+lat+','+lng+'&key=AIzaSyD3N7NC_ztTEmHt8BugovKtg1sHCOyfs6Y'

        $.getJSON(url,function(res){
          results = res['results']
          city = results[0]['address_components'][3]['long_name']
          country = results[0]['address_components'][6]['short_name']
          // get News  exp:  https://newsapi.org/v1/sources?language=en
          var language = null
          if($('#language').text()==='English'){language='en'}
          else if($('#language').text()==='French'){language='fr'}
          else {language='de'}
          category = $('#category').text()
          url = 'https://newsapi.org/v1/sources?language='+language+'&category='+category+'&country=us'
          $.getJSON(url,function(res){
            newsSources = res['sources']
            newsList = $('#newsList')
            newsList.html('')
            for(var i = 0;i<newsSources.length;i++){
              name = newsSources[i].name
              url = newsSources[i].url
              newsDescriptions.push(newsSources[i].description)
              id = "news"+i+""
              innerHtml = "<li><a href='"+url+"'>"+name+"</a>"+"<a class='play' href='#' id="+id+" style='float:right'>play</div>"
              newsList.append(innerHtml)
            }
            visualizeJson(res['sources'])
          })
        })
      })   
    }

    $('h6').click(function(event){
      var h = event.target
      var id = h.getAttribute('id')
      text = $('#'+id).text()
      id = parseInt(id)
      if(id>=0 && id<=9){
        $('#category').text(text)
      }
      else{
        $('#language').text(text)
      }
    })

    $('body').delegate('a.play','click',function(event){
      var play = event.target
      var id = play.getAttribute('id')
      id = id.slice(4,id.length)
      i = parseInt(id)
      var descrip = newsDescriptions[i]
      var speech = new SpeechSynthesisUtterance(descrip);
      window.speechSynthesis.speak(speech)
    })
    Ax = []
    Ay = []
    Az = []
    count = 0
    startTime = new Date().getTime()
    // document.addEventListener('plusready',function(){
    //   plus.accelerometer.getCurrentAcceleration(function(a){
    //     alert('hehe')
    //   })
    // },false)
    window.ondevicemotion=function(e){
      curAx = event.accelerationIncludingGravity.x * 5;
      curAy = event.accelerationIncludingGravity.y * 5;
      curAz = event.accelerationIncludingGravity.z * 5;
      Ax.push(curAx)
      Ay.push(curAy)
      Az.push(curAz)
      console.log(curAx,curAy,curAz)
      count++
    }

 var myChart = echarts.init(document.getElementById('chart'),'macarons')
 var datax = []
 var datay = []
 var dataz = []
 var lastLength = 0
 var time = 0
 function init(){
  sum = 0
  for(i = 0;i<Ax.length;i++){
    sum+=Ax[i]
  }
  datax.push({name:(1+lastLength).toString(),value:[1+lastLength,sum/Ax.length]})    
  sum = 0
  for(i = 0;i<Ay.length;i++){
    sum+=Ay[i]
  }

  datay.push({name:(1+lastLength).toString(),value:[1+lastLength,sum/Ay.length]})
  sum = 0

  for(i = 0;i<Az.length;i++){
    sum+=Az[i]
  }
  dataz.push({name:(1+lastLength).toString(),value:[1+lastLength,sum/Az.length]})
  lastLength = datax.length
  Ax = []
  Ay = []
  Az = []
  option = {
      title: {
          text: ' '
      },
      tooltip:{
        trigger:'axis'
      },
      legend:{
        data:['x-axis','y-axis','z-axis']
      },
      xAxis: {
          type: 'value',
          splitLine: {
              show: false
          }
      },
      yAxis: {
          type: 'value',
          boundaryGap: [0, '100%'],
          splitLine: {
              show: false
          }
      },
      series: [{
          name: 'x-axis',
          type: 'line',
          showSymbol: false,
          hoverAnimation: false,
          data: datax
      },
      {
          name: 'y-axis',
          type: 'line',
          showSymbol: false,
          hoverAnimation: false,
          data: datay
      },
      {
          name: 'z-axis',
          type: 'line',
          showSymbol: false,
          hoverAnimation: false,
          data: dataz
      }]
  };
  myChart.setOption(option)
 }
  setTimeout(init,1000)

  setInterval(function(){
    sum = 0
    for(i = 0;i<Ax.length;i++){
      sum+=Ax[i]
    }
    datax.push({name:(lastLength+1).toString(),value:[lastLength+1,sum/Ax.length]})    
    sum = 0
    for(i = 0;i<Ay.length;i++){
      sum+=Ay[i]
    }
    datay.push({name:(1+lastLength).toString(),value:[1+lastLength,sum/Ay.length]})
    sum = 0
    for(i = 0;i<Az.length;i++){
      sum+=Az[i]
    }
    dataz.push({name:(1+lastLength).toString(),value:[1+lastLength,sum/Az.length]})
    Ax = []
    Ay = []
    Az = []
    lastLength = datax.length
    myChart.setOption({series:[{data:datax},{data:datay},{data:dataz}]})
    time++
  },1000) 
  var myBoard = new DrawingBoard.Board('drawBoard');

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script type="text/javascript" src="raphael.js"></script>
  <script type="text/javascript" src="hammer.js"></script>
  <script type="text/javascript" src="index.js"></script><i title="Raphaël Colour Picker" style="display: none; color: red;"></i> </body>

</html>
